<app-header></app-header>

<!-- OUTER BG -->
<div class="w-full flex justify-center px-3 sm:px-6 py-6 sm:py-10 bg-[#F5FAFC]">
  <div class="w-full max-w-5xl bg-white rounded-2xl shadow-lg px-4 sm:px-10 py-6 sm:py-10">

    <!-- ================= HEADER / STEPPER ================= -->
    <div class="flex items-center mb-6 sm:mb-10">
      <!-- Back button only for Step 1 -->
      <button *ngIf="step === 1" type="button" (click)="goBack()" class="hidden sm:flex items-center mr-4 group">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-[#006D8D] group-hover:text-[#004b60] transition"
          fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 6l-6 6 6 6" />
        </svg>
      </button>

      <div class="flex-1 flex justify-center">
        <div class="flex items-center space-x-4 sm:space-x-8">

          <!-- STEP 1 -->
          <div class="flex flex-col items-center">
            <div class="flex items-center justify-center rounded-full text-xs font-semibold
            w-8 h-8 sm:w-7 sm:h-7" [ngClass]="step === 1 ? 'bg-[#006D8D] text-white' : 'bg-[#E4EDF1] text-[#006D8D]'">
              1
            </div>
            <span class="mt-1 text-[11px] text-gray-600 hidden md:block whitespace-nowrap">
              Select Members
            </span>
          </div>

          <div class="h-px w-8 sm:w-12 bg-gray-300"></div>

          <!-- STEP 2 -->
          <div class="flex flex-col items-center">
            <div class="flex items-center justify-center rounded-full text-xs font-semibold
            w-8 h-8 sm:w-7 sm:h-7" [ngClass]="step === 2 ? 'bg-[#006D8D] text-white' : 'bg-[#E4EDF1] text-[#006D8D]'">
              2
            </div>
            <span class="mt-1 text-[11px] text-gray-600 hidden md:block whitespace-nowrap">
              Basic Details
            </span>
          </div>

          <div class="h-px w-8 sm:w-12 bg-gray-300"></div>

          <!-- STEP 3 -->
          <div class="flex flex-col items-center">
            <div class="flex items-center justify-center rounded-full text-xs font-semibold
            w-8 h-8 sm:w-7 sm:h-7" [ngClass]="step === 3 ? 'bg-[#006D8D] text-white' : 'bg-[#E4EDF1] text-[#006D8D]'">
              3
            </div>
            <span class="mt-1 text-[11px] text-gray-600 hidden md:block whitespace-nowrap">
              Additional Details
            </span>
          </div>

        </div>
      </div>
    </div>

    <!-- ======================= STEP 1 ======================= -->
    <div *ngIf="step === 1" class="space-y-6 sm:space-y-8">
      <h2 class="text-center text-base sm:text-xl font-medium text-gray-700">
        Select your gender
      </h2>

      <div class="mx-auto w-full max-w-[260px] h-9 sm:h-10 rounded-full border border-[#006D8D]
      flex overflow-hidden">
        <button type="button" (click)="setGender('Male')" class="flex-1 text-sm font-medium transition"
          [ngClass]="gender === 'Male' ? 'bg-[#006D8D] text-white' : 'bg-white text-[#006D8D]'">
          Male
        </button>

        <button type="button" (click)="setGender('Female')" class="flex-1 text-sm font-medium transition"
          [ngClass]="gender === 'Female' ? 'bg-[#006D8D] text-white' : 'bg-white text-[#006D8D]'">
          Female
        </button>
      </div>

      <h3 class="text-center text-sm sm:text-xl font-semibold text-gray-700">
        Select member you want to insure
      </h3>

      <!-- ONLY SELF -->
      <div class="flex justify-center mt-4 sm:mt-6">
        <div class="flex flex-col items-center justify-center w-[140px] sm:w-[170px]
        h-[160px] sm:h-[210px] bg-white border border-[#E6EEF5]
        rounded-[18px] shadow-card cursor-pointer">
          <img [src]="youIcon" class="mt-5 w-14 h-14 object-contain" />
          <p class="mt-3 text-xs sm:text-sm font-semibold text-gray-700">Self</p>
        </div>
      </div>

      <div class="flex justify-center mt-6">
        <button (click)="next()" class="w-[150px] sm:w-[170px] h-10 sm:h-11 rounded-full
            bg-[#006D8D] text-white shadow-next hover:bg-[#005b75] text-sm sm:text-base">
          Next
        </button>
      </div>
    </div>


    <!-- ================= STEP 2 : BASIC DETAILS ================= -->
    <form [formGroup]="basicForm">
      <div *ngIf="step === 2" class="w-full">

        <h2 class="text-xl font-semibold text-[#006D8D] mb-6">Personal Details</h2>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">

          <!-- FIRST NAME -->
          <div>
            <label class="pp-label">First Name <span class="text-red-600">*</span></label>
            <input formControlName="firstName" type="text" class="pp-input" (keypress)="allowOnlyLetters($event)"
              (input)="onNameInput('firstName')" placeholder="Enter first name" />

            <p *ngIf="isInvalid('firstName')" class="pp-error">Enter valid first name</p>
          </div>

          <!-- LAST NAME -->
          <div>
            <label class="pp-label">Last Name <span class="text-red-600">*</span></label>
            <input formControlName="lastName" type="text" class="pp-input" (keypress)="allowOnlyLetters($event)"
              (input)="onNameInput('lastName')" placeholder="Enter last name" />

            <p *ngIf="isInvalid('lastName')" class="pp-error">Enter valid last name</p>
          </div>

          <!-- DOB -->
          <div>
            <label class="pp-label">Date of Birth <span class="text-red-600">*</span></label>
            <input formControlName="dob" type="date" class="pp-input" (change)="validateDOB()" />
            <p *ngIf="dobError" class="pp-error">Age must be 18 or above</p>
          </div>

        </div>

        <!-- ROW 2 -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-8">

          <!-- MOBILE -->
          <div>
            <label class="pp-label">Mobile Number <span class="text-red-600">*</span></label>
            <input maxlength="10" formControlName="mobile" type="text" class="pp-input"
              (keypress)="allowOnlyDigits($event)" placeholder="Enter mobile number" />
            <p *ngIf="isInvalid('mobile')" class="pp-error">Enter valid 10-digit mobile</p>
          </div>

          <!-- PINCODE -->
          <div>
            <label class="pp-label">Pincode <span class="text-red-600">*</span></label>
            <input maxlength="6" formControlName="pincode" type="text" class="pp-input"
              (keypress)="allowOnlyDigits($event)" placeholder="Enter pincode" />
            <p *ngIf="isInvalid('pincode')" class="pp-error">Enter valid 6-digit pincode</p>
          </div>

          <!-- CITY -->
          <div>
            <label class="pp-label">City <span class="text-red-600">*</span></label>
            <input formControlName="city" type="text" class="pp-input" (keypress)="allowOnlyLetters($event)"
              placeholder="Enter city" />
            <p *ngIf="isInvalid('city')" class="pp-error">Enter valid city name</p>
          </div>

        </div>

        <div class="mt-10 flex justify-end">
          <button type="button" (click)="next()" class="pp-btn-primary">Continue</button>
        </div>
      </div>

      <!-- ================= STEP 3 : ADDITIONAL DETAILS ================= -->
      <div *ngIf="step === 3" class="w-full">

        <h2 class="text-xl font-semibold text-[#006D8D] mb-6">Additional Details</h2>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-8">

          <!-- OCCUPATION -->
          <div>
            <label class="pp-label">Occupation of Insured <span class="text-red-600">*</span></label>
            <select formControlName="occupation" class="pp-select">
              <option value="" disabled>Select Occupation</option>
              <option value="Salaried">Salaried</option>
              <option value="Self Employed">Self Employed/Buisness</option>
              <option value="No Active Source of Income">Income from other sources</option>
            </select>
            <p *ngIf="isInvalid('occupation')" class="pp-error">Please select occupation</p>
          </div>

          <!-- INCOME -->
          <div>
            <label class="pp-label">Annual Income Range <span class="text-red-600">*</span></label>
            <select formControlName="incomeRange" class="pp-select">
              <option value="" disabled>Select Income Range</option>
              <option>₹3 Lakh – ₹5 Lakh</option>
              <option>₹6 Lakh – ₹8 Lakh</option>
              <option>₹9 Lakh – ₹12 Lakh</option>
              <option>₹13 Lakh – ₹18 Lakh</option>
              <option>₹19 Lakh – ₹25 Lakh</option>
              <option>₹26 Lakh – ₹40 Lakh</option>
              <option>₹41 Lakh and Above</option>
            </select>
            <p *ngIf="isInvalid('incomeRange')" class="pp-error">Please select income range</p>
          </div>

          <!-- RISK CATEGORY (IMPROVED ONLY THIS UI) -->
          <div>
            <label class="pp-label">Risk Category <span class="text-red-600">*</span></label>

            <div class="pp-select cursor-pointer flex items-center justify-between" (click)="openRiskPopup()">
              {{ selectedRiskCategory || 'Select Risk Category' }}
            </div>

            <p *ngIf="riskError" class="pp-error">Please select a risk category</p>
          </div>

          <!-- COVER AMOUNT -->
          <div>
            <label class="pp-label">Cover Amount <span class="text-red-600">*</span></label>
            <select formControlName="coverAmount" class="pp-select">
              <option value="" disabled>Select Cover Amount</option>
              <option value="1000000">10 Lakh</option>
              <option value="1500000">15 Lakh</option>
              <option value="2000000">20 Lakh</option>
              <option value="2500000">25 Lakh</option>
              <option value="5000000">30 Lakh</option>
              <option value="3500000">35 Lakh</option>
              <option value="5000000">50 Lakh</option>
              <option value="7500000">75 Lakh</option>
              <option value="10000000">1 Crore</option>
              <option value="20000000">2 Crore</option>
              <option value="30000000">3 Crore</option>
              <option value="40000000">4 Crore</option>
              <option value="50000000">5 Crore</option>
            </select>
            <p *ngIf="isInvalid('coverAmount')" class="pp-error">Please select cover amount</p>
          </div>

        </div>

        <div class="flex justify-between mt-10">
          <button type="button" class="pp-btn-secondary" (click)="prev()">Back</button>
          <button type="button" class="pp-btn-primary" (click)="next()">Get Quotes</button>
        </div>

      </div>
    </form>


    <!-- ================== RISK POPUP ================== -->
    <div *ngIf="showRiskPopup" class="popup-overlay" (click)="closeRiskPopup()"></div>
    <div *ngIf="showRiskPopup" class="risk-popup animate-popup" (click)="$event.stopPropagation()">

      <!-- Tabs -->
      <div class="popup-tabs">
        <button *ngFor="let tab of riskTabs; let i=index" class="popup-tab" [class.active]="activeRiskTab === i"
          (click)="activeRiskTab = i">
          {{ tab }}
        </button>

      </div>

      <!-- Items -->
      <div class="mt-4 space-y-3">
        <div *ngFor="let item of riskList[activeRiskTab]" class="popup-row"
          [class.selected]="selectedRiskCategory === item" (click)="selectRisk(item)">
          <span class="bullet-dot"></span>
          <span>{{ item }}</span>
        </div>
      </div>
    </div>
  </div>
</div>

<app-footer></app-footer>