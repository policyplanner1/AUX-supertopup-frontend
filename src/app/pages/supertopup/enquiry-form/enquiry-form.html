<!-- OUTER BG -->
<div class="w-full flex justify-center px-3 sm:px-6 py-6 sm:py-10 bg-[#F5FAFC]">
  <!-- WHITE CARD SHELL -->
  <div
    class="w-full max-w-5xl bg-white rounded-2xl shadow-lg px-4 sm:px-10 py-6 sm:py-10"
  >
    <!-- ================= HEADER / STEPPER ================= -->
    <div class="flex items-center mb-6 sm:mb-10">
      <!-- Back / Previous: visible from sm and up (mobile design doesn't show it) -->
      <button
        type="button"
        (click)="prev()"
        class="hidden sm:inline-flex items-center text-[#006D8D] text-sm font-medium mr-4"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-4 h-4 mr-1"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"
          />
        </svg>
        Previous
      </button>

      <!-- Stepper (1-2-3) -->
      <div class="flex-1 flex justify-center">
        <div class="flex items-center space-x-4 sm:space-x-8">
          <!-- STEP 1 -->
          <div class="flex flex-col items-center">
            <div
              class="flex items-center justify-center rounded-full text-xs font-semibold
                     w-8 h-8 sm:w-7 sm:h-7"
              [ngClass]="
                step === 1
                  ? 'bg-[#006D8D] text-white'
                  : 'bg-[#E4EDF1] text-[#006D8D]'
              "
            >
              1
            </div>
            <!-- hide labels on small screens, show on md+ (to match mobile Figma) -->
            <span
              class="mt-1 text-[11px] text-gray-600 hidden md:block whitespace-nowrap"
            >
              Select Members
            </span>
          </div>

          <!-- connector line -->
          <div class="h-px w-8 sm:w-12 bg-gray-300"></div>

          <!-- STEP 2 -->
          <div class="flex flex-col items-center">
            <div
              class="flex items-center justify-center rounded-full text-xs font-semibold
                     w-8 h-8 sm:w-7 sm:h-7"
              [ngClass]="
                step === 2
                  ? 'bg-[#006D8D] text-white'
                  : 'bg-[#E4EDF1] text-[#006D8D]'
              "
            >
              2
            </div>
            <span
              class="mt-1 text-[11px] text-gray-600 hidden md:block whitespace-nowrap"
            >
              Select Age of Members
            </span>
          </div>

          <div class="h-px w-8 sm:w-12 bg-gray-300"></div>

          <!-- STEP 3 -->
          <div class="flex flex-col items-center">
            <div
              class="flex items-center justify-center rounded-full text-xs font-semibold
                     w-8 h-8 sm:w-7 sm:h-7"
              [ngClass]="
                step === 3
                  ? 'bg-[#006D8D] text-white'
                  : 'bg-[#E4EDF1] text-[#006D8D]'
              "
            >
              3
            </div>
            <span
              class="mt-1 text-[11px] text-gray-600 hidden md:block whitespace-nowrap"
            >
              Basic Details
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- ======================= STEP 1 ======================= -->
    <div *ngIf="step === 1" class="space-y-6 sm:space-y-8">
      <!-- Heading -->
      <h2 class="text-center text-base sm:text-xl font-medium text-gray-700">
        Select your gender
      </h2>

      <!-- Gender Toggle -->
      <div
        class="mx-auto w-full max-w-[260px] h-9 sm:h-10 rounded-full border border-[#006D8D] flex overflow-hidden"
      >
        <button
          type="button"
          (click)="setGender('Male')"
          class="flex-1 text-sm sm:text-base font-medium transition"
          [ngClass]="
            gender === 'Male'
              ? 'bg-[#006D8D] text-white'
              : 'bg-white text-[#006D8D]'
          "
        >
          Male
        </button>
        <button
          type="button"
          (click)="setGender('Female')"
          class="flex-1 text-sm sm:text-base font-medium transition"
          [ngClass]="
            gender === 'Female'
              ? 'bg-[#006D8D] text-white'
              : 'bg-white text-[#006D8D]'
          "
        >
          Female
        </button>
      </div>

      <!-- Subheading -->
      <h3 class="text-center text-sm sm:text-xl font-semibold text-gray-700">
        Select members you want to insure
      </h3>

      <!-- Member Cards (2 columns on mobile, 4 on md+) -->
      <div
        class="w-full max-w-md sm:max-w-3xl mx-auto grid grid-cols-2 md:grid-cols-4
               gap-4 sm:gap-6 justify-items-center"
      >
        <ng-container *ngFor="let m of members">
          <div
            (click)="toggleMember(m.key)"
            class="relative flex flex-col items-center
                   w-full max-w-[140px] sm:max-w-[170px]
                   h-[160px] sm:h-[210px]
                   rounded-[18px] border bg-white cursor-pointer
                   shadow-card transition-transform duration-200 hover:-translate-y-1"
            [ngClass]="m.selected ? 'gradient-border' : 'border-[#E6EEF5]'"
          >
            <!-- icon -->
            <img
              [src]="m.iconPath"
              class="mt-5 sm:mt-6 w-14 h-14 sm:w-16 sm:h-16 object-contain"
            />

            <!-- label -->
            <p
              class="mt-3 sm:mt-4 text-xs sm:text-sm font-semibold text-gray-700"
            >
              {{ m.label }}
            </p>

            <!-- child counter pinned at bottom for Son / Daughter (visible desktop & mobile) -->
            <div
              *ngIf="m.key === 'son' || m.key === 'daughter'"
              class="mt-auto mb-3 sm:mb-4 pt-2 flex items-center justify-center gap-5"
            >
              <button
                (click)="decrementChild(m.key); $event.stopPropagation()"
                class="w-6 h-6 sm:w-7 sm:h-7 rounded-full border border-[#00A2C4]
                       flex items-center justify-center text-[#00A2C4] text-sm"
                [disabled]="m.count === 0"
              >
                –
              </button>

              <span
                class="text-xs sm:text-sm font-semibold text-gray-700 min-w-[1.5rem] text-center"
              >
                {{ m.count }}
              </span>

              <button
                (click)="incrementChild(m.key); $event.stopPropagation()"
                class="w-6 h-6 sm:w-7 sm:h-7 rounded-full border border-[#00A2C4]
                       flex items-center justify-center text-[#00A2C4] text-sm"
                [disabled]="getTotalChildren() >= maxChildren"
              >
                +
              </button>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Global children counter row like Figma (optional – keep if you use it) -->
      <!-- <div
        *ngIf="getTotalChildren() > 0"
        class="flex items-center justify-center space-x-6 pt-1 sm:pt-2"
      >
        <button
          (click)="decrementChild('son')"
          class="w-5 h-5 rounded-full border border-[#006D8D]
                 flex items-center justify-center text-[#006D8D] text-xs"
          [disabled]="getTotalChildren() === 0"
        >
          –
        </button>
        <span class="text-sm font-semibold text-gray-700">
          {{ getTotalChildren() }}
        </span>
        <button
          (click)="incrementChild('son')"
          class="w-5 h-5 rounded-full border border-[#006D8D]
                 flex items-center justify-center text-[#006D8D] text-xs"
          [disabled]="getTotalChildren() >= maxChildren"
        >
          +
        </button>
      </div> -->

      <!-- Next Button -->
      <div class="flex justify-center mt-4 sm:mt-8">
        <button
          (click)="next()"
          class="w-[150px] sm:w-[170px] h-10 sm:h-11 rounded-full
                 bg-[#006D8D] text-white shadow-next hover:bg-[#005b75] text-sm sm:text-base"
        >
          Next
        </button>
      </div>
    </div>

    <!-- ======================= STEP 2 ======================= -->
    <div *ngIf="step === 2" class="space-y-6 sm:space-y-10">
      <h2
        class="text-center text-base sm:text-2xl font-medium text-gray-700 tracking-wide"
      >
        Tell us the age of your family members
      </h2>

      <!-- AGE CARDS: wrap + center -->
      <div class="flex flex-wrap justify-center gap-6 sm:gap-10 mt-2 sm:mt-4">
        <ng-container *ngFor="let id of getFlatMemberList()">
          <div
            class="w-[180px] sm:w-[220px] bg-white rounded-xl border border-[#E5EFF4]
                   shadow-card flex flex-col items-center text-center pt-6 sm:pt-8 pb-5 sm:pb-6"
          >
            <img
              [src]="getIconForId(id)"
              class="w-16 h-16 sm:w-20 sm:h-20 object-contain"
            />

            <p class="mt-3 sm:mt-4 text-sm sm:text-base font-medium text-gray-700">
              {{ getAgeTitle(id) }}
            </p>

            <div class="mt-5 sm:mt-6 w-full px-6 sm:px-8">
              <div class="relative inline-block w-full">
                <select
                  class="w-full border-0 border-b border-gray-400 bg-transparent
                         text-xs sm:text-sm text-gray-700 pb-1 pr-5
                         focus:outline-none focus:border-[#006D8D] appearance-none"
                  [(ngModel)]="selectedAges[id]"
                  (ngModelChange)="setAge(id, $event)"
                >
                  <option value="">Select Age</option>
                  <option
                    *ngIf="id.startsWith('son') || id.startsWith('daughter')"
                    value="0.4"
                  >
                    91 Days
                  </option>
                  <option
                    *ngFor="let a of (id.startsWith('son') || id.startsWith('daughter') ? childAges : adultAges)"
                    [value]="a"
                  >
                    {{ a }} Years
                  </option>
                </select>

                <span
                  class="pointer-events-none absolute right-0 top-1/2 -translate-y-1/2
                         text-[#006D8D] text-[10px] sm:text-xs"
                >
                  ▾
                </span>
              </div>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Nav buttons -->
      <div class="flex justify-center gap-4 sm:gap-5 mt-4 sm:mt-8">
        <button
          (click)="prev()"
          class="px-6 sm:px-8 py-2.5 sm:py-3 rounded-[20px] border border-gray-300
                 text-xs sm:text-sm font-medium text-gray-700 hover:bg-gray-100"
        >
          Previous
        </button>

        <button
          (click)="next()"
          class="px-8 sm:px-10 py-2.5 sm:py-3 rounded-[20px] bg-[#006D8D] text-white
                 text-xs sm:text-sm font-medium shadow-next hover:bg-[#005B75]"
        >
          Next
        </button>
      </div>
    </div>

    <!-- ======================= STEP 3 ======================= -->
    <div *ngIf="step === 3" class="space-y-8 sm:space-y-12">
      <h2
        class="text-center text-base sm:text-2xl font-medium text-gray-700 tracking-wide"
      >
        Tell us more about yourself
      </h2>

      <form [formGroup]="basicForm" class="max-w-5xl mx-auto space-y-8 sm:space-y-12">
        <!-- Row 1: 3 fields -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-x-10 sm:gap-x-16 gap-y-6">
          <div>
            <label class="block text-[#006D8D] text-xs sm:text-sm font-semibold mb-1">
              Enter First Name
            </label>
            <input
              formControlName="firstName"
              class="w-full border-0 border-b border-gray-400 bg-transparent py-2
                     text-gray-700 text-sm focus:outline-none focus:border-[#006D8D]"
              placeholder="First Name"
            />
          </div>

          <div>
            <label class="block text-[#006D8D] text-xs sm:text-sm font-semibold mb-1">
              Enter Last Name
            </label>
            <input
              formControlName="lastName"
              class="w-full border-0 border-b border-gray-400 bg-transparent py-2
                     text-gray-700 text-sm focus:outline-none focus:border-[#006D8D]"
              placeholder="Last Name"
            />
          </div>

          <div>
            <label class="block text-[#006D8D] text-xs sm:text-sm font-semibold mb-1">
              Enter Mobile Number
            </label>
            <input
              formControlName="mobile"
              class="w-full border-0 border-b border-gray-400 bg-transparent py-2
                     text-gray-700 text-sm focus:outline-none focus:border-[#006D8D]"
              placeholder="Mobile Number"
            />
          </div>
        </div>

        <!-- Row 2: 4 fields -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-x-10 sm:gap-x-16 gap-y-6">
          <div>
            <label class="block text-[#006D8D] text-xs sm:text-sm font-semibold mb-1">
              Enter Pincode
            </label>
            <input
              formControlName="pincode"
              class="w-full border-0 border-b border-gray-400 bg-transparent py-2
                     text-gray-700 text-sm focus:outline-none focus:border-[#006D8D]"
              placeholder="Pincode"
            />
          </div>

          <div>
            <label class="block text-[#006D8D] text-xs sm:text-sm font-semibold mb-1">
              Enter or select City
            </label>
            <input
              formControlName="city"
              class="w-full border-0 border-b border-gray-400 bg-transparent py-2
                     text-gray-700 text-sm focus:outline-none focus:border-[#006D8D]"
              placeholder="City"
            />
          </div>

          <!-- <div>
            <label class="block text-[#006D8D] text-xs sm:text-sm font-semibold mb-1">
              Zone
            </label>
            <input
              formControlName="zone"
              readonly
              class="w-full border-0 border-b border-gray-400 bg-transparent py-2
                     text-gray-700 text-sm focus:outline-none cursor-default"
            />
          </div> -->

          <div>
            <label class="block text-[#006D8D] text-xs sm:text-sm font-semibold mb-1">
              Cover Amount
            </label>
            <select
              formControlName="coverAmount"
              class="w-full border-0 border-b border-gray-400 bg-transparent py-2
                     text-gray-700 text-sm focus:outline-none focus:border-[#006D8D] appearance-none"
            >
              <option value="">Cover Amount</option>
              <option value="300000">3 Lakh</option>
              <option value="500000">5 Lakh</option>
              <option value="600000">6 Lakh</option>
              <option value="700000">7 Lakh</option>
              <option value="800000">8 Lakh</option>
              <option value="1000000">10 Lakh</option>
              <option value="1100000">11 Lakh</option>
              <option value="1200000">12 Lakh</option>
              <option value="1500000">15 Lakh</option>
              <option value="1600000">16 Lakh</option>
              <option value="2000000">20 Lakh</option>
              <option value="2500000">25 Lakh</option>
              <option value="5000000">50 Lakh</option>
              <option value="10000000">1 Crore</option>
              <option value="30000000">3 Crore</option>
            </select>
          </div>
        </div>
      </form>

      <!-- Buttons -->
      <div class="flex flex-col sm:flex-row justify-between items-center mt-4 gap-4">
        <button
          class="w-full sm:w-auto px-6 py-2.5 rounded border border-gray-300
                 text-gray-700 text-sm hover:bg-gray-100"
          (click)="prev()"
        >
          Previous
        </button>

        <button
          class="w-full sm:w-auto px-10 py-2.5 rounded-[20px] bg-[#006D8D] text-white
                 text-sm shadow-next hover:bg-[#005B75]"
          (click)="next()"
        >
          Submit
        </button>
      </div>
    </div>
  </div>
</div>
